DROP DATABASE HOUSEHOLD;
CREATE DATABASE HOUSEHOLD;
USE HOUSEHOLD;

CREATE TABLE MST_LANGUAGE_TYPE(
	CODE CHAR(1) NOT NULL,
	NAME VARCHAR(5) NOT NULL,
	ISACTIVE BIT DEFAULT 1 NOT NULL,
	
	PRIMARY KEY(CODE)
);
 
INSERT INTO MST_LANGUAGE_TYPE (CODE, NAME, ISACTIVE) VALUES('0','kor',1);
INSERT INTO MST_LANGUAGE_TYPE (CODE, NAME, ISACTIVE) VALUES('1','eng',1);
INSERT INTO MST_LANGUAGE_TYPE (CODE, NAME, ISACTIVE) VALUES('2','jpn',1);
 
CREATE TABLE MST_LOCALIZATION(
	`KEY` NVARCHAR(100) NOT NULL,
	`TYPE` CHAR(1) NOT NULL,
	`VALUE` NVARCHAR(255) NOT NULL,
	ISACTIVE BIT DEFAULT 1 NOT NULL,
	
	PRIMARY KEY(`KEY`,`TYPE`),
	FOREIGN KEY (`TYPE`) REFERENCES MST_LANGUAGE_TYPE(CODE)
);
 
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNote','0',N'가계부',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNote','1',N'Private finance note',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNote','2',N'`家計簿',1);

CREATE TABLE MST_GROUP(
  CODE CHAR(3) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  ISDEFAULT BIT DEFAULT 0 NOT NULL,
  ISACTIVE BIT DEFAULT 1 NOT NULL,
 
  PRIMARY KEY(CODE)
);
 
INSERT INTO MST_GROUP (CODE, NAME, ISDEFAULT, ISACTIVE) VALUES('GES', N'Guest', 1, 1);
INSERT INTO MST_GROUP (CODE, NAME, ISDEFAULT, ISACTIVE) VALUES('USR', N'User', 0, 1);
INSERT INTO MST_GROUP (CODE, NAME, ISDEFAULT, ISACTIVE) VALUES('ADM', N'Admin', 0, 1);
 
CREATE TABLE MST_VIEWROLE(
  CODE CHAR(4) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  ISACTIVE BIT DEFAULT 1 NOT NULL,
  
  PRIMARY KEY (CODE)
);
 
INSERT INTO MST_VIEWROLE (CODE, NAME, ISACTIVE) VALUES('PFNV', N'PrivateFinanceNoteItemList', 1);
INSERT INTO MST_VIEWROLE (CODE, NAME, ISACTIVE) VALUES('CTGV', N'PrivateFinanceNoteCategoryList', 1);
INSERT INTO MST_VIEWROLE (CODE, NAME, ISACTIVE) VALUES('ADMN', N'Admin', 1);
 
CREATE TABLE MST_ACTIONROLE(
  CODE CHAR(4) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  ISACTIVE BIT DEFAULT 1 NOT NULL,
  
  PRIMARY KEY (CODE)
);
 
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('PFNA', N'PrivateFinanceNoteItemAdd', 1);
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('PFND', N'PrivateFinanceNoteItemDelete', 1);
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('PFNM', N'PrivateFinanceNoteItemModify', 1);
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('CTGA', N'PrivateFinanceNoteCategoryAdd', 1);
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('CTGD', N'PrivateFinanceNoteCategoryDelete', 1);
INSERT INTO MST_ACTIONROLE (CODE, NAME, ISACTIVE) VALUES('CTGM', N'PrivateFinanceNoteCategoryModify', 1);
 
CREATE TABLE TSN_USER(
  ID VARCHAR(255) NOT NULL,
  EMAIL VARCHAR(255) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  COUNTRY CHAR(1) DEFAULT '0' NOT NULL,
  CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
  ISDELTED BIT DEFAULT 0 NOT NULL,
 
  PRIMARY KEY(ID),
  FOREIGN KEY (COUNTRY) REFERENCES MST_LANGUAGE_TYPE(CODE)
);
 
CREATE TABLE MAP_USER_GROUP(
  ID VARCHAR(100) NOT NULL,
  CODE CHAR(3) NOT NULL,
  
  PRIMARY KEY (ID, CODE),
  FOREIGN KEY (ID) REFERENCES TSN_USER(ID),
  FOREIGN KEY (CODE) REFERENCES MST_GROUP(CODE)
);

CREATE TABLE MAP_VIEW_ROLE_GROUP(
  VIEWCODE CHAR(4) NOT NULL,
  GROUPCODE CHAR(3) NOT NULL,
  
  PRIMARY KEY (VIEWCODE, GROUPCODE),
  FOREIGN KEY (VIEWCODE) REFERENCES MST_VIEWROLE(CODE),
  FOREIGN KEY (GROUPCODE) REFERENCES MST_GROUP(CODE)
);
 
CREATE TABLE MAP_VIEW_ROLE_USER(
  VIEWCODE CHAR(4) NOT NULL,
  ID VARCHAR(100) NOT NULL,
  
  PRIMARY KEY (VIEWCODE, ID),
  FOREIGN KEY (VIEWCODE) REFERENCES MST_VIEWROLE(CODE),
  FOREIGN KEY (ID) REFERENCES TSN_USER(ID)
);
 
CREATE TABLE MAP_ACTION_ROLE_GROUP(
  ROLECODE CHAR(4) NOT NULL,
  GROUPCODE CHAR(3) NOT NULL,
  
  PRIMARY KEY (ROLECODE, GROUPCODE),
  FOREIGN KEY (ROLECODE) REFERENCES MST_ACTIONROLE(CODE),
  FOREIGN KEY (GROUPCODE) REFERENCES MST_GROUP(CODE)
);
 
CREATE TABLE MAP_ACTION_ROLE_USER(
  ROLECODE CHAR(4) NOT NULL,
  ID VARCHAR(100) NOT NULL,
  
  PRIMARY KEY (ROLECODE, ID),
  FOREIGN KEY (ROLECODE) REFERENCES MST_ACTIONROLE(CODE),
  FOREIGN KEY (ID) REFERENCES TSN_USER(ID)
);

INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemList','0',N'가계부 리스트',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemList','1',N'Private finance note list',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemList','2',N'家計簿リスト',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryList','0',N'가계부 카테고리 리스트',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryList','1',N'Private finance category list',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryList','2',N'家計簿カテゴリリスト',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemAdd','0',N'가계부 추가',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemAdd','1',N'Private finance item add',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemAdd','2',N'家計簿追加',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemDelete','0',N'가계부 삭제',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemDelete','1',N'Private finance item delete',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemDelete','2',N'家計簿削除',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemModify','0',N'가계부 수정',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemModify','1',N'Private finance item modify',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteItemModify','2',N'家計簿修正',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryAdd','0',N'가계부 카테고리 추가',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryAdd','1',N'Private finance category add',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryAdd','2',N'家計簿カテゴリ追加',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryDelete','0',N'가계부 카테고리 삭제',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryDelete','1',N'Private finance category delted',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryDelete','2',N'家計簿カテゴリ削除',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryModify','0',N'가계부 카테고리 수정',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryModify','1',N'Private finance category modify',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'PrivateFinanceNoteCategoryModify','2',N'家計簿カテゴリ修正',1);

CREATE TABLE MST_LOW_CATEGORY(
  CODE CHAR(1) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  ISACTIVE BIT DEFAULT 1 NOT NULL,
 
  PRIMARY KEY(CODE)
);
 
INSERT INTO MST_LOW_CATEGORY (CODE, NAME, ISACTIVE) VALUES('i','Income',1);
INSERT INTO MST_LOW_CATEGORY (CODE, NAME, ISACTIVE) VALUES('e','Expenditure',1);
INSERT INTO MST_LOW_CATEGORY (CODE, NAME, ISACTIVE) VALUES('s','Saving',1);
 
CREATE TABLE TSN_CATEGORY(
  IDX INT NOT NULL AUTO_INCREMENT,
  LOWCATEGORYCODE CHAR(1) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  ISDELETED BIT DEFAULT 0 NOT NULL,
 
  PRIMARY KEY(IDX),
  FOREIGN KEY (LOWCATEGORYCODE) REFERENCES MST_LOW_CATEGORY (CODE)
);
 
CREATE TABLE TSN_PAYMENT(
  IDX INT NOT NULL AUTO_INCREMENT,
  LOWCATEGORYCODE CHAR(1) NOT NULL,
  CATEGORYKEY INT NOT NULL,
  `DATE` DATETIME NOT NULL,
  CONTENTS NVARCHAR(255) NOT NULL,
  MONEY DECIMAL(20) NOT NULL,
  COMMENT NVARCHAR(255),
  ISDELETED BIT DEFAULT 0 NOT NULL,
  CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
  CREATER VARCHAR(255) NOT NULL,
  UPDATEDDATE DATETIME NULL,
  UPDATER VARCHAR(255) NULL,
 
  PRIMARY KEY(IDX),
  FOREIGN KEY (LOWCATEGORYCODE) REFERENCES MST_LOW_CATEGORY (CODE),
  FOREIGN KEY (CATEGORYKEY) REFERENCES TSN_CATEGORY (IDX),
  FOREIGN KEY (CREATER) REFERENCES TSN_USER (ID),
  FOREIGN KEY (UPDATER) REFERENCES TSN_USER (ID)
);

INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Income','0',N'수입',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Income','1',N'Income',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Income','2',N'収入',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Expenditure','0',N'지출',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Expenditure','1',N'Expenditure',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Expenditure','2',N'支出',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Saving','0',N'저축',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Saving','1',N'Saving',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Saving','2',N'貯蓄',1);

CREATE TABLE MST_MENU(
  CODE CHAR(4) NOT NULL,
  NAME NVARCHAR(255) NOT NULL,
  VIEWCODE CHAR(4) NULL,
  ICON VARCHAR(255) NOT NULL,
  LINK VARCHAR(255) NOT NULL,
  SEQUENCE INT NOT NULL,
  ISACTIVE BIT DEFAULT 1 NOT NULL,
  
  PRIMARY KEY(CODE),
  FOREIGN KEY (VIEWCODE) REFERENCES MST_VIEWROLE(CODE)
);
INSERT INTO MST_MENU (`CODE`, `NAME`, `VIEWCODE`, ICON, LINK, SEQUENCE, ISACTIVE) VALUES('DASH', N'Dashboard', null, 'fas fa-fw fa-tachometer-alt', './main.html', 1, 1);
INSERT INTO MST_MENU (`CODE`, `NAME`, `VIEWCODE`, ICON, LINK, SEQUENCE, ISACTIVE) VALUES('FNNC', N'Finence', 'PFNV', 'fas fa-clipboard-list', './finence.html', 2, 1);
INSERT INTO MST_MENU (`CODE`, `NAME`, `VIEWCODE`, ICON, LINK, SEQUENCE, ISACTIVE) VALUES('CTGV', N'Category', 'CTGV', 'fas fa-gavel', './category.html', 3, 1);
INSERT INTO MST_MENU (`CODE`, `NAME`, `VIEWCODE`, ICON, LINK, SEQUENCE, ISACTIVE) VALUES('ADMN', N'Admin', 'ADMN', 'fas fa-luggage-cart', './admin.html', 4, 1);

INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Dashboard','0',N'Dashboard',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Dashboard','1',N'Dashboard',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Dashboard','2',N'Dashboard',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Finence','0',N'가계',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Finence','1',N'Finence',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Finence','2',N'家計',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Category','0',N'카테고리',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Category','1',N'Category',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Category','2',N'カテゴリ',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Admin','0',N'Admin',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Admin','1',N'Admin',1);
INSERT INTO MST_LOCALIZATION (`KEY`, `TYPE`, `VALUE`, ISACTIVE) VALUES(N'Admin','2',N'Admin',1);

update map_user_group set code = 'ADM';
INSERT INTO map_view_role_group (VIEWCODE,GROUPCODE) values('ADMN','ADM');
INSERT INTO map_view_role_group (VIEWCODE,GROUPCODE) values('CTGV','ADM');
INSERT INTO map_view_role_group (VIEWCODE,GROUPCODE) values('PFNV','ADM');